---
title: Manually authenticating users
image: "https://og.composio.dev/api/og?title=Manually%20Authenticating%20Users"
description: "Authenticate users to toolkits outside of chat"
keywords: "tool router, authentication, manual, authorize, toolkits"
---

Manual authentication lets you connect users to toolkits outside of the chat flow. Use this when you want to:
- Pre-authenticate users before they start chatting
- Build a custom connections UI in your app

## Create session

Disable the `COMPOSIO_MANAGE_CONNECTIONS` meta-tool so the agent doesn't prompt for auth during chat:

<CodeGroup>
```python
session = composio.create(
    user_id="user_123",
    manage_connections=False,
)
```
```typescript
const session = await composio.create("user_123", {
  manageConnections: false,
});
```
</CodeGroup>

## Check connection status

Use `session.toolkits()` to see which apps the user has connected:

<CodeGroup>
```python
toolkits = session.toolkits()

for toolkit in toolkits:
    status = toolkit.connected_account.status if toolkit.connected_account else "Not connected"
    print(f"{toolkit.name}: {status}")
```
```typescript
const toolkits = await session.toolkits();

for (const toolkit of toolkits) {
  const status = toolkit.connectedAccount?.status || "Not connected";
  console.log(`${toolkit.name}: ${status}`);
}
```
</CodeGroup>

Each toolkit includes:
- `name`, `slug`, `logo`, `description`
- `connectedAccount` - present if user is connected, includes `id`, `status`, `createdAt`

### Filter and sort

Use filters to show relevant toolkits in your UI:

<CodeGroup>
```python
toolkits = session.toolkits(
    order_by="popularity",        # Sort by most used
    order_direction="desc",
    category="developer-tools",   # Filter by category
    is_connected=True,            # Only show connected apps
)
```
```typescript
const toolkits = await session.toolkits({
  orderBy: "popularity",        // Sort by most used
  orderDirection: "desc",
  category: "developer-tools",  // Filter by category
  isConnected: true,            // Only show connected apps
});
```
</CodeGroup>

## Generate auth URL

Use `session.authorize()` to generate a [Connect Link](/docs/authenticating-tools#hosted-authentication-connect-link) URL:

<CodeGroup>
```python
connection_request = session.authorize(
    "gmail",
    callback_url="https://yourapp.com/callback"
)

print(connection_request.redirect_url)
# https://connect.composio.dev/link/ln_abc123
```
```typescript
const connectionRequest = await session.authorize("gmail", {
  callbackUri: "https://yourapp.com/callback",
});

console.log(connectionRequest.redirectUrl);
// https://connect.composio.dev/link/ln_abc123
```
</CodeGroup>

Redirect the user to `redirectUrl`. After they authenticate, they'll be redirected to your `callbackUrl`.

## Wait for connection

Use `waitForConnection()` to poll until the user completes authentication:

<CodeGroup>
```python
connected_account = connection_request.wait_for_connection(60000)
print(f"Connected: {connected_account.id}")
```
```typescript
const connectedAccount = await connectionRequest.waitForConnection(60000);
console.log(`Connected: ${connectedAccount.id}`);
```
</CodeGroup>

- Default timeout: 60 seconds (60000ms)
- Throws `ConnectionRequestTimeoutError` if timeout expires
- Throws `ConnectionRequestFailedError` if connection fails or expires

<Note>
If the user closes the Connect Link without completing auth, the connection remains in `INITIATED` status until it expires.
</Note>

## Putting it together

A common pattern is to verify all required connections before starting the agent. For example, a personal assistant might need Gmail, Calendar, Linear, and Slack:

<CodeGroup>
<SnippetCode src="fern/snippets/tool-router/python/manual-auth.py" title="Python" />
<SnippetCode src="fern/snippets/tool-router/typescript/manual-auth.ts" title="TypeScript" />
</CodeGroup>
